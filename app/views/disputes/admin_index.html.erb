<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-gavel me-2"></i>Dispute Management</h2>
    <div>
      <span class="badge bg-danger"><%= Dispute.active.count %> Active</span>
      <span class="badge bg-warning text-dark"><%= Dispute.escalated.count %> Escalated</span>
    </div>
  </div>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <%= form_tag(admin_disputes_path, method: :get, class: "row g-3") do %>
        <div class="col-md-3">
          <select name="status" class="form-select">
            <option value="">All Statuses</option>
            <% Dispute::STATUSES.each do |s| %>
              <option value="<%= s %>" <%= 'selected' if params[:status] == s %>><%= s.humanize %></option>
            <% end %>
          </select>
        </div>
        <div class="col-md-3">
          <select name="priority" class="form-select">
            <option value="">All Priorities</option>
            <% Dispute::PRIORITIES.each do |p| %>
              <option value="<%= p %>" <%= 'selected' if params[:priority] == p %>><%= p.capitalize %></option>
            <% end %>
          </select>
        </div>
        <div class="col-md-3">
          <select name="type" class="form-select">
            <option value="">All Types</option>
            <% Dispute::TYPES.each do |t| %>
              <option value="<%= t %>" <%= 'selected' if params[:type] == t %>><%= t.humanize %></option>
            <% end %>
          </select>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-2"></i>Filter</button>
        </div>
      <% end %>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Type</th>
          <th>Title</th>
          <th>Opened By</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Days Open</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @disputes.each do |dispute| %>
          <tr class="<%= 'table-danger' if dispute.priority == 'urgent' %>">
            <td><%= dispute.id %></td>
            <td><%= dispute.dispute_type.humanize %></td>
            <td><%= truncate(dispute.title, length: 40) %></td>
            <td><%= dispute.opened_by.name %></td>
            <td><%= dispute.transaction.amount %> <%= dispute.transaction.currency %></td>
            <td>
              <% status_class = case dispute.status
                 when 'opened' then 'warning'
                 when 'escalated' then 'danger'
                 when 'resolved' then 'success'
                 else 'info'
                 end %>
              <span class="badge bg-<%= status_class %>"><%= dispute.status.humanize %></span>
            </td>
            <td>
              <% priority_class = case dispute.priority
                 when 'urgent' then 'danger'
                 when 'high' then 'warning'
                 else 'secondary'
                 end %>
              <span class="badge bg-<%= priority_class %>"><%= dispute.priority.capitalize %></span>
            </td>
            <td><%= dispute.days_open %></td>
            <td>
              <%= link_to "View", dispute_path(dispute), class: "btn btn-sm btn-primary" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%= will_paginate @disputes, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
</div>
